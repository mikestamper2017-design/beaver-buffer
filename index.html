<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #001f3f; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', Gadget, sans-serif; }
        #ui-layer { 
            position: absolute; 
            top: 40px; 
            width: 750px; 
            display: flex; 
            justify-content: space-between; 
            color: #fff; 
            pointer-events: none; 
            z-index: 10; 
            font-size: 42px; /* Massive Visibility */
            text-shadow: 4px 4px 8px #000; 
            letter-spacing: 2px;
        }
        canvas { border: 8px solid #fff; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .stat-label { font-size: 18px; display: block; color: #ffd700; text-transform: uppercase; }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div><span class="stat-label">Time Remaining</span><span id="timer">30</span></div>
        <div style="text-align: right;"><span class="stat-label">Ice Polished</span><span id="score">0%</span></div>
    </div>
<script>
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 800,
        scene: { preload: preload, create: create, update: update }
    };

    const game = new Phaser.Game(config);
    let beaver, rt, pondMask, brush;
    let scoreText, timerText;
    let timeLeft = 30;
    let totalCleaned = 0;

    function preload() {
        this.load.image('pond', 'pond.jpg?v=5'); 
        this.load.image('beaver', 'beaver.png?v=5');
        let graphics = this.make.graphics({ x: 0, y: 0, add: false });
        graphics.fillStyle(0xffffff, 1);
        graphics.fillCircle(40, 40, 40);
        graphics.generateTexture('brush', 80, 80);
    }

    function create() {
        this.add.image(400, 400, 'pond').setDisplaySize(800, 800);
        rt = this.make.renderTexture({ width: 800, height: 800 }, false);
        rt.fill(0xcceeff, 0.85);
        rt.setOrigin(0, 0);

        pondMask = new Phaser.Geom.Ellipse(400, 600, 600, 350);
        let shape = this.make.graphics();
        shape.fillStyle(0xffffff);
        shape.fillEllipse(pondMask.x, pondMask.y, pondMask.width, pondMask.height);
        rt.setMask(shape.createGeometryMask());

        beaver = this.add.sprite(400, 600, 'beaver').setScale(0.25);
        scoreText = document.getElementById('score');
        timerText = document.getElementById('timer');

        this.time.addEvent({
            delay: 1000,
            callback: () => {
                if (timeLeft > 0) {
                    timeLeft--;
                    timerText.innerText = timeLeft;
                    if(timeLeft <= 5) timerText.style.color = "#ff4444";
                } else {
                    alert(`Pond Complete! Score: ${Math.floor(totalCleaned)}%`);
                    location.reload();
                }
            },
            callbackScope: this, loop: true
        });
    }

    function update() {
        let pointer = this.input.activePointer;
        if (pointer.isDown) {
            if (pondMask.contains(pointer.x, pointer.y)) {
                beaver.x = Phaser.Math.Linear(beaver.x, pointer.x, 0.2);
                beaver.y = Phaser.Math.Linear(beaver.y, pointer.y, 0.2);
                
                // VIBRATION TRIGGER
                // This triggers the browser's native vibration (works on Android/some Mobile Browsers)
                // For iOS App Store, we will use your Capawesome plugin next!
                if (navigator.vibrate) {
                    navigator.vibrate(10); 
                }

                rt.erase('brush', beaver.x, beaver.y + 25);
                if (totalCleaned < 100) {
                    totalCleaned += 0.2;
                    scoreText.innerText = `${Math.floor(totalCleaned)}%`;
                }
            }
        }
    }
</script>
</body>
</html>
