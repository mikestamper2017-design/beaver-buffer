<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #001f3f; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', Gadget, sans-serif; }
        #ui-layer { position: absolute; top: 40px; width: 750px; display: flex; justify-content: space-between; color: #fff; pointer-events: none; z-index: 10; font-size: 42px; text-shadow: 4px 4px 8px #000; }
        .stat-label { font-size: 18px; display: block; color: #ffd700; text-transform: uppercase; }
        
        /* Custom End Screen */
        #end-screen { 
            position: absolute; display: none; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 100%; background: rgba(0,31,63,0.9); z-index: 100; color: white; text-align: center;
        }
        #rank-title { font-size: 60px; color: #ffd700; margin-bottom: 10px; }
        #rank-msg { font-size: 30px; margin-bottom: 30px; }
        button { padding: 15px 40px; font-size: 24px; font-weight: bold; cursor: pointer; border-radius: 50px; border: none; background: #fff; color: #001f3f; }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div><span class="stat-label">Timer</span><span id="timer">30</span></div>
        <div style="text-align: right;"><span class="stat-label">Polished</span><span id="score">0%</span></div>
    </div>

    <div id="end-screen">
        <div id="rank-title">ROOKIE</div>
        <div id="rank-msg">Give'r another go, eh?</div>
        <button onclick="location.reload()">PLAY AGAIN</button>
    </div>

<script>
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 800,
        scene: { preload: preload, create: create, update: update }
    };

    const game = new Phaser.Game(config);
    let beaver, rt, pondMask;
    let timeLeft = 30;
    let totalCleaned = 0;
    let isGameOver = false;

    function preload() {
        this.load.image('pond', 'pond.jpg?v=6'); 
        this.load.image('beaver', 'beaver.png?v=6');
        let graphics = this.make.graphics({ x: 0, y: 0, add: false });
        graphics.fillStyle(0xffffff, 1);
        graphics.fillCircle(40, 40, 40);
        graphics.generateTexture('brush', 80, 80);
    }

    function create() {
        this.add.image(400, 400, 'pond').setDisplaySize(800, 800);
        rt = this.make.renderTexture({ width: 800, height: 800 }, false);
        rt.fill(0xcceeff, 0.85);
        rt.setOrigin(0, 0);

        pondMask = new Phaser.Geom.Ellipse(400, 600, 600, 350);
        let shape = this.make.graphics();
        shape.fillStyle(0xffffff);
        shape.fillEllipse(pondMask.x, pondMask.y, pondMask.width, pondMask.height);
        rt.setMask(shape.createGeometryMask());

        beaver = this.add.sprite(400, 600, 'beaver').setScale(0.25);

        this.time.addEvent({
            delay: 1000,
            callback: () => {
                if (timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timer').innerText = timeLeft;
                } else if (!isGameOver) {
                    showEndScreen();
                }
            },
            callbackScope: this, loop: true
        });
    }

    function showEndScreen() {
        isGameOver = true;
        const screen = document.getElementById('end-screen');
        const title = document.getElementById('rank-title');
        const msg = document.getElementById('rank-msg');
        
        let score = Math.floor(totalCleaned);
        
        if (score < 15) {
            title.innerText = "DIRTY POND!";
            msg.innerText = "You're a real keener, but the ice is still a mess!";
        } else if (score < 40) {
            title.innerText = "OUT FOR A STROLL?";
            msg.innerText = "Not too bad for a rookie, eh?";
        } else if (score < 70) {
            title.innerText = "GOOD EFFORT, BUD!";
            msg.innerText = "You're starting to get the hang of it!";
        } else if (score < 90) {
            title.innerText = "SOLID JOB, YA HOSER!";
            msg.innerText = "Take off to the next level, you're a pro!";
        } else {
            title.innerText = "LEGENDARY BUFFER!";
            msg.innerText = "Holy Mackinaw! That ice is pure glass!";
        }
        
        screen.style.display = 'flex';
    }

    function update() {
        if (isGameOver) return;
        let pointer = this.input.activePointer;
        if (pointer.isDown && pondMask.contains(pointer.x, pointer.y)) {
            beaver.x = Phaser.Math.Linear(beaver.x, pointer.x, 0.2);
            beaver.y = Phaser.Math.Linear(beaver.y, pointer.y, 0.2);
            if (navigator.vibrate) navigator.vibrate(10);
            rt.erase('brush', beaver.x, beaver.y + 25);
            if (totalCleaned < 100) {
                totalCleaned += 0.25;
                document.getElementById('score').innerText = `${Math.floor(totalCleaned)}%`;
            }
        }
    }
</script>
</body>
</html>
